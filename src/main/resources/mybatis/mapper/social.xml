<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.SocialDao">
<select id="count" parameterType="String" resultType="int">
	select count(*)
	from social
	where mid=#{mid}
</select>

<insert id="insert" parameterType="social">
	<selectKey keyProperty="sno" resultType="int" order="BEFORE">
			select seq_sno.nextval from dual
	</selectKey>
	insert into social(sno, mid, ctno, stitle, scontent,
	 sthumbdata, sthumbtype, sthumbname, swritedate, sstartdate, senddate, 
	 sstarttime, sfee, smembercount, sstatus, saddress)
	 values(#{sno}, #{mid}, #{ctno}, #{stitle}, #{scontent}, 
	 #{sthumbData}, #{sthumbType}, #{sthumbName}, sysdate, #{sstartDate}, #{sendDate},
	 #{sstartTime}, #{sfee}, 0, #{sstatus}, #{saddress})
</insert>

<select id="selectBySno" parameterType="int" resultType="social">
	select sno, mid, ctno, stitle, scontent, swritedate, sstartdate, senddate, 
	 sstarttime, sfee, smembercount, sstatus, saddress
	from social
	where sno=#{sno}
</select>

<select id="selectSocialListByParams" parameterType="Map" resultType="social">
	select rnum, sno, stitle, saddress, sfee, ctno
	from(
		select rownum as rnum, sno, stitle, saddress, sfee, ctno
		from(
			select sno, stitle, saddress, sfee, ctno
			from social
			where <![CDATA[sstatus='모집']]>
			<if test="ctno != null">
			 and ctno=#{ctno}
			</if>
			<if test="sort == 'deadline'">
			order by sstartdate, sstarttime
			</if>
			<if test="sort == null or sort == 'recently'">
			order by sno desc
			</if>
		)
		where <![CDATA[ rownum <= #{pager.endRowNo}]]>
	)
	where <![CDATA[ rnum >= #{pager.startRowNo}]]> 
</select>

<select id="selectSthumbBySno" parameterType="int" resultType="social">
	select sthumbname, sthumbtype, sthumbdata
	from social
	where sno=#{sno}
</select>

<select id="countByCtno" parameterType="Map" resultType="int">
	select count(*)
	from social
	<if test="ctno != null">
	where ctno=#{ctno}
	</if>
</select>

<update id="updateSstatusBySno" parameterType="Map">
	update social set sstatus=#{sstatus}
	where sno=#{sno}
</update>

</mapper>
